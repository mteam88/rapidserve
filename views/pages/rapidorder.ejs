<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/_head') %>
  </head>
  <body onload="updateContent()" id="grad">
    <div class="topnav shadow">
        <a class="navlogospot" href="/"><img class="navlogo" src="/public/assets/Rlogo.png"></img></a>
        <a href="rapidpoll">Poll</a>
        <a class="active" href="rapidorder">Order</a>
        <a href="info">Info</a>
      </div>

      <h1 class="bubbleheader">Rapid Order</h1>

      <p>Input your order, then click "Place Order."</p>
      <button style="float: right;width: 75px" onclick="toghlp()">Help</button>
      <div id="hlptxt" class="bubbleheader">
        <h2 style="text-align: center;">Help</h2>
        <p>
          Select items that you would like to order by clicking on them or tapping them.
          When a box is next to the selection, you can choose multiple items.
          If you want to change your selection, click or tap on the item that you currently have selected.
          Then, click or tap on your new item.
          When you are satisfied with your selections, click on or tap the "Place Order" button.
  
          If you still need help, contact us or tell your teacher.
        </p>
      </div>

      <div id=orderstuff>
        <!-- <form action="/rapidorder" method="POST">
          <label for="body">orderBody</label>
          <textarea id="body" name="orderBody" required></textarea>
          <button>Submit</button>
        </form> -->
        
        
       <table id="ordertable">
          <tr id="headerrow">
            <th>Main Course</th>
            <th>Side</th>
            <th>Drink</th>
          </tr>
          <tr id="menu-row0" class="selectable">
            <td onclick="changebg(this)">Chicken Sandwich</td>
            <td onclick="changebg(this)">Apples</td>
            <td onclick="changebg(this)">Milk</td>
          </tr>
          <tr id="menu-row1" class="selectable">
            <td onclick="changebg(this)">Cheeseburger</td>
            <td onclick="changebg(this)">Lettuce</td>
            <td onclick="changebg(this)">Apple Juice</td>
          </tr>
        </table>
        <button id='submitButton' style="float: right;">Place Order</button>
      </div> 
      <script>
        const submitButton = document.getElementById('submitButton');

        submitButton.addEventListener('click', (e) => {
          const endpoint = '/rapidorder/';
          var orderBody = {orderBody: "Blah!!!"};

          var table = document.getElementById("ordertable").rows;
          var boxes = [];

          var loopAmount = table.length;
          for (var i = 0;i < loopAmount;i++) {
            if (table[i].id.includes("menu-row")) {
              var loopAmount2 = table[i].cells.length;
              for (var k = 0;k < loopAmount2;k++) {
                boxes.push(table[i].cells[k]);
              }
            }
          }
          
          var output = [];//CEDRIC starts here
          var loopAmount = boxes.length;
          for (var i = 0;i < loopAmount;i++) {
            var BG = (boxes[i].style.backgroundColor == "red") ? 1 : 0;
            //console.log(j);
            output.push(BG);
          } 
          
          console.log(output);
          output = output.join('');
          //alert(output);
          var orderBody = output;
          //CEDRIC this is stuff i did. feel free to comment it out.

          var formatted = [];
          var encodedKey = encodeURIComponent('orderBody');
          var encodedValue = encodeURIComponent(output);
          formatted.push(encodedKey + "=" + encodedValue);
          //alert(formatted);

          fetch(endpoint, {
            method: 'POST',
            headers: {
              //'Content-Type': 'application/json'
              'Accept': 'application/json',
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formatted
          })
          .then(response => response.json())
              .then((data) => {
                //alert(data);
                //alert(data.status)
                if (data.status == 'success') {
                  //alert("success!!!");
                  plcordr();
                }
          })
          .catch((err) => {alert(err)})
        });
      </script>
      <image src="/public/assets/Rlogo.png" id="bottomof"></image>
  </body>
</html>